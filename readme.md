# REST API TEST AUTOMATION

## Описание

REST API Test Generator — это инструмент для автоматической генерации тестов на основе OpenAPI спецификации и JSON сценариев. Система позволяет создавать комплексные тестовые сценарии с поддержкой шаблонов, ссылок между тестами и автоматической валидацией схемы.

---

## Особенности

- **Автоматическая генерация тестов** на основе OpenAPI спецификации
    
- **Поддержка сложных сценариев** с шаблонами и ссылками
    
- **Взаимосвязанные тесты** — возможность ссылаться на значения из других шагов
    
- **Встроенная валидация** схемы и совместимости с OpenAPI
    
- **Гибкая структура** с разделением на PRESET, TESTS и AFTER-TEST
    
- **Конфигурируемая генерация** случайных данных с seed
    
- **Расширяемая DSL генерации значений** (`random`, `minimum`, `modify` и др.)
    
- **Детальное логирование** всех этапов генерации
    

---

# Формат сценариев тестов

## Базовая структура

```json
{
  "<Имя_endpoint>": {
    "PRESET": {},
    "TESTS": {},
    "AFTER-TEST": {}
  }
}
```

---

## Компоненты сценария

|Компонент|Описание|
|---|---|
|**PRESET**|Подготовка тестовой среды|
|**TESTS**|Основной блок тестирования|
|**AFTER-TEST**|Очистка тестовой среды|
|**steps**|Последовательность шагов|
|**endpoint**|API endpoint|
|**method**|HTTP метод (GET, POST и др.)|
|**parameters**|Параметры запроса|
|**validation**|Проверка ответа|
|**expected**|Ожидаемый статус|

---

# Поддерживаемые значения параметров

|Значение|Описание|Пример|
|---|---|---|
|`"random"`|Генерация значения по OpenAPI `pattern`|`"port": "random"`|
|`"minimum"`|Минимальное значение|`"age": "minimum"`|
|`"maximum"`|Максимальное значение|`"count": "maximum"`|
|`"gt_max"`|Значение больше максимума|`"key": "gt_max"`|
|`"lt_min"`|Значение меньше минимума|`"key": "lt_min"`|
|Константа|Фиксированное значение|`"enabled": true`|
|Ссылка|Значение из другого шага|`{"ref": "#TESTS.1.steps.1.parameters.id"}`|
|`modify`|Расширенная генерация (см. ниже)|см. раздел ниже|

---

# Расширенная генерация: `modify`

`modify` позволяет управлять выбором конкретного паттерна из OpenAPI-спецификации.

Особенно полезно при использовании `anyOf`, когда параметр может иметь несколько форматов (например, IPv4 или имя интерфейса).

---

## Формат

```json
{
  "parameter_name": {
    "value": "random",
    "modify": "<тип>"
  }
}
```

- `value` — базовая стратегия (обычно `"random"`)
    
- `modify` — уточнение типа генерации
    

---

## Поддерживаемые типы `modify`

|Тип|Описание|Пример|
|---|---|---|
|`"ipv4"`|Выбрать IPv4-паттерн|`"modify": "ipv4"`|
|`"ifname"`|Выбрать паттерн имени интерфейса|`"modify": "ifname"`|
|`0`, `1`, `2`|Выбрать паттерн по индексу из `anyOf`|`"modify": 1`|
|`"regex"`|Использовать собственный regex|см. пример ниже|

---

## Примеры

### Принудительно IPv4

```json
"source": {
  "value": "random",
  "modify": "ipv4"
}
```

Результат:

```json
"source": "192.168.10.1"
```

---

### Принудительно имя интерфейса

```json
"source": {
  "value": "random",
  "modify": "ifname"
}
```

Результат:

```json
"source": "vlan100"
```

---

### Выбор конкретного anyOf

```json
"source": {
  "value": "random",
  "modify": 1
}
```

---

### Собственный regex

```json
"source": {
  "value": "random",
  "modify": "regex",
  "regex": "^eth[0-9]+\\.[0-9]+$"
}
```

---

## Как работает `modify`

1. OpenAPI анализируется.
    
2. Извлекаются все `pattern`, `minimum`, `maximum`.
    
3. `modify` фильтрует доступные паттерны.
    
4. Генерация выполняется через `rstr.xeger`.
    
5. Если фильтр не дал результата — используется безопасный fallback.
    
6. В итоговый тест записывается уже сгенерированное значение (не DSL).
    

---

# Пример полного сценария

```json
{
  "/interfaces/tunnel/add": {
    "TESTS": {
      "1": {
        "description": "Create tunnel with forced ifname source",
        "steps": {
          "1": {
            "endpoint": "/interfaces/tunnel/add",
            "method": "POST",
            "parameters": {
              "ifname": "random",
              "source": {
                "value": "random",
                "modify": "ifname"
              },
              "key": "maximum"
            },
            "expected": {
              "errCode": 0,
              "httpCode": 200
            }
          }
        }
      }
    }
  }
}
```

---

# Структура проекта

```
.
├── scenarios/
├── templates/
├── tests/
├── generate_test.py
├── run_test.py
├── config/
└── utils/
```

---

# Быстрый старт

## Генерация всех тестов

```bash
python3 generate_test.py
```

## Генерация конкретных endpoint

```bash
python3 generate_test.py -e users_get
```

## Генерация с seed

```bash
python3 generate_test.py -s 12345
```

## Подробный режим

```bash
python3 generate_test.py -v
```

---

# Процесс генерации

1. Парсинг сценария
    
2. Валидация структуры
    
3. Разрешение OpenAPI схемы
    
4. Извлечение ограничений (`pattern`, `minimum`, `maximum`)
    
5. Генерация значений
    
6. Формирование тестов
    
7. Очистка пустых директорий
    

---

# Логирование

- Подробные логи сохраняются в `logs/`
    
- Поддерживается verbose режим
    
- В логах отображаются:
    
    - выбранные паттерны
        
    - сгенерированные значения
        
    - ошибки и fallback
        

---

# Расширяемость

Вы можете:

- Добавлять новые типы `modify`
    
- Расширять генерацию значений
    
- Интегрировать бизнес-логику
    
- Создавать собственные шаблоны
