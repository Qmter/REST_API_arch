Пытаемся загрузить шаблон из: templates/_vrf_templates.json
Шаблон: #TEMPLATES./vrf.TESTS.ADD успешно загружен!
Пытаемся загрузить шаблон из: templates/_vrf_templates.json
Шаблон: #TEMPLATES./vrf.TESTS.DELETE успешно загружен!
==================================================
Сценарий успешно загружен!
{
  "/interfaces/loopback/add": {
    "PRESET": {
      "steps": {
        "1": {
          "endpoint": "/vrf",
          "method": "POST",
          "parameters": {
            "action": "add",
            "vrf_name": "random"
          },
          "expected": {
            "errCode": 0,
            "httpCode": 200
          }
        },
        "2": {
          "endpoint": "/interfaces/loopback/add",
          "method": "POST",
          "parameters": {
            "ifname": "random",
            "vrf_name": {
              "ref": "#PRESET.steps.1.parameters.vrf_name"
            }
          },
          "expected": {
            "errCode": 0,
            "httpCode": 200
          }
        }
      }
    },
    "TESTS": {
      "1": {
        "description": "Add loopback with VRF",
        "steps": {
          "1": {
            "endpoint": "/interfaces/loopback/add",
            "method": "POST",
            "parameters": {
              "ifname": "random",
              "vrf_name": {
                "ref": "#PRESET.steps.1.parameters.vrf_name"
              }
            },
            "expected": {
              "errCode": 0,
              "httpCode": 200
            }
          }
        }
      }
    },
    "AFTER-TEST": {
      "steps": {
        "1": {
          "endpoint": "/vrf",
          "method": "POST",
          "parameters": {
            "action": "delete",
            "vrf_name": {
              "ref": "#PRESET.steps.1.parameters.vrf_name"
            }
          },
          "expected": {
            "errCode": 0,
            "httpCode": 200
          }
        }
      }
    }
  }
}
==================================================
==================================================
Все ендпоинты, присутствующие в сценирии:
{'/interfaces/loopback/add': 'POST', '/vrf': 'POST'}
==================================================
==================================================
Разрешенная схема для /interfaces/loopback/add POST:
==================================================
{
  "tags": [
    "interfaces/loopback"
  ],
  "summary": "Add loopback interface",
  "description": "Add loopback interface\n\nCLI command: `interface lo`",
  "requestBody": {
    "required": true,
    "content": {
      "application/json": {
        "schema": {
          "description": "Add loopback interface",
          "required": [
            "ifname"
          ],
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "ifname": {
              "description": "loopback interface name",
              "type": "string",
              "pattern": "^lo(0|[1-9][0-9]{0,3})$"
            },
            "vrf_name": {
              "type": "string",
              "pattern": "^[A-Za-z0-9_-]{1,12}$",
              "description": "VRF NAME (Only letters and numbers, 12 characters max)"
            }
          }
        }
      }
    }
  },
  "responses": {
    "200": {
      "description": "Interface added successfully",
      "content": {
        "application/json": {
          "schema": {
            "title": "generic output PDUs",
            "description": "JSON format of response PDU for the communication between web backend and mprdaemon. Objects cannot contain properties other than ['errCode', 'result', 'request']",
            "required": [
              "errCode",
              "result",
              "request"
            ],
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "errCode": {
                "title": "error code",
                "description": "error code of operation, nonzero means error, string describes details of error",
                "type": "array",
                "prefixItems": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": [
                      "string",
                      "null"
                    ]
                  }
                ],
                "maxItems": 2,
                "minItems": 2
              },
              "result": {},
              "request": {}
            }
          }
        }
      }
    }
  }
}
==================================================
Разрешенная схема для /vrf POST:
==================================================
{
  "tags": [
    "vrf"
  ],
  "summary": "add/delete VRF",
  "description": "add/delete VRF\n\nCLI commands: `[no] ip vrf`",
  "requestBody": {
    "required": true,
    "content": {
      "application/json": {
        "schema": {
          "description": "Add/delete VRF",
          "type": "object",
          "required": [
            "vrf_name",
            "action"
          ],
          "additionalProperties": false,
          "properties": {
            "vrf_name": {
              "type": "string",
              "pattern": "^[A-Za-z0-9_-]{1,12}$",
              "description": "VRF NAME (Only letters and numbers, 12 characters max)"
            },
            "action": {
              "type": "string",
              "enum": [
                "add",
                "delete"
              ]
            }
          }
        }
      }
    }
  },
  "responses": {
    "200": {
      "description": "done",
      "content": {
        "application/json": {
          "schema": {
            "title": "generic output PDUs",
            "description": "JSON format of response PDU for the communication between web backend and mprdaemon. Objects cannot contain properties other than ['errCode', 'result', 'request']",
            "required": [
              "errCode",
              "result",
              "request"
            ],
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "errCode": {
                "title": "error code",
                "description": "error code of operation, nonzero means error, string describes details of error",
                "type": "array",
                "prefixItems": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": [
                      "string",
                      "null"
                    ]
                  }
                ],
                "maxItems": 2,
                "minItems": 2
              },
              "result": {},
              "request": {}
            }
          }
        }
      }
    }
  }
}
==================================================
Разрешены ссылки для ендпоинтов:
{
  "/interfaces/loopback/add": {
    "tags": [
      "interfaces/loopback"
    ],
    "summary": "Add loopback interface",
    "description": "Add loopback interface\n\nCLI command: `interface lo`",
    "requestBody": {
      "required": true,
      "content": {
        "application/json": {
          "schema": {
            "description": "Add loopback interface",
            "required": [
              "ifname"
            ],
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "ifname": {
                "description": "loopback interface name",
                "type": "string",
                "pattern": "^lo(0|[1-9][0-9]{0,3})$"
              },
              "vrf_name": {
                "type": "string",
                "pattern": "^[A-Za-z0-9_-]{1,12}$",
                "description": "VRF NAME (Only letters and numbers, 12 characters max)"
              }
            }
          }
        }
      }
    },
    "responses": {
      "200": {
        "description": "Interface added successfully",
        "content": {
          "application/json": {
            "schema": {
              "title": "generic output PDUs",
              "description": "JSON format of response PDU for the communication between web backend and mprdaemon. Objects cannot contain properties other than ['errCode', 'result', 'request']",
              "required": [
                "errCode",
                "result",
                "request"
              ],
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "errCode": {
                  "title": "error code",
                  "description": "error code of operation, nonzero means error, string describes details of error",
                  "type": "array",
                  "prefixItems": [
                    {
                      "type": "integer"
                    },
                    {
                      "type": [
                        "string",
                        "null"
                      ]
                    }
                  ],
                  "maxItems": 2,
                  "minItems": 2
                },
                "result": {},
                "request": {}
              }
            }
          }
        }
      }
    }
  },
  "/vrf": {
    "tags": [
      "vrf"
    ],
    "summary": "add/delete VRF",
    "description": "add/delete VRF\n\nCLI commands: `[no] ip vrf`",
    "requestBody": {
      "required": true,
      "content": {
        "application/json": {
          "schema": {
            "description": "Add/delete VRF",
            "type": "object",
            "required": [
              "vrf_name",
              "action"
            ],
            "additionalProperties": false,
            "properties": {
              "vrf_name": {
                "type": "string",
                "pattern": "^[A-Za-z0-9_-]{1,12}$",
                "description": "VRF NAME (Only letters and numbers, 12 characters max)"
              },
              "action": {
                "type": "string",
                "enum": [
                  "add",
                  "delete"
                ]
              }
            }
          }
        }
      }
    },
    "responses": {
      "200": {
        "description": "done",
        "content": {
          "application/json": {
            "schema": {
              "title": "generic output PDUs",
              "description": "JSON format of response PDU for the communication between web backend and mprdaemon. Objects cannot contain properties other than ['errCode', 'result', 'request']",
              "required": [
                "errCode",
                "result",
                "request"
              ],
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "errCode": {
                  "title": "error code",
                  "description": "error code of operation, nonzero means error, string describes details of error",
                  "type": "array",
                  "prefixItems": [
                    {
                      "type": "integer"
                    },
                    {
                      "type": [
                        "string",
                        "null"
                      ]
                    }
                  ],
                  "maxItems": 2,
                  "minItems": 2
                },
                "result": {},
                "request": {}
              }
            }
          }
        }
      }
    }
  }
}
==================================================
==================================================
Аргументы ендпоинта и его паттерны:
==================================================
{
  "/interfaces/loopback/add": {
    "ifname": {
      "pattern": [
        "^lo(0|[1-9][0-9]{0,3})$"
      ]
    },
    "vrf_name": {
      "pattern": [
        "^[A-Za-z0-9_-]{1,12}$"
      ]
    }
  },
  "/vrf": {
    "vrf_name": {
      "pattern": [
        "^[A-Za-z0-9_-]{1,12}$"
      ]
    }
  }
}
==================================================
==================================================
==================================================
----------------------------------------
Путь: /interfaces/loopback/add.PRESET.steps.1
Endpoint: /vrf
Method: POST
Parameters: {'action': 'add', 'vrf_name': 'random'}
Validation: {}
Expected: {'errCode': 0, 'httpCode': 200}
----------------------------------------
key = vrf_name, arg_value = 2lbJr
----------------------------------------
Путь: /interfaces/loopback/add.PRESET.steps.2
Endpoint: /interfaces/loopback/add
Method: POST
Parameters: {'ifname': 'random', 'vrf_name': {'ref': '#PRESET.steps.1.parameters.vrf_name'}}
Validation: {}
Expected: {'errCode': 0, 'httpCode': 200}
----------------------------------------
key = ifname, arg_value = lo0
ref_link = 2lbJr
----------------------------------------
Путь: /interfaces/loopback/add.TESTS.1.steps.1
Endpoint: /interfaces/loopback/add
Method: POST
Parameters: {'ifname': 'random', 'vrf_name': {'ref': '#PRESET.steps.1.parameters.vrf_name'}}
Validation: {}
Expected: {'errCode': 0, 'httpCode': 200}
----------------------------------------
key = ifname, arg_value = lo0
ref_link = 2lbJr
----------------------------------------
Путь: /interfaces/loopback/add.AFTER-TEST.steps.1
Endpoint: /vrf
Method: POST
Parameters: {'action': 'delete', 'vrf_name': {'ref': '#PRESET.steps.1.parameters.vrf_name'}}
Validation: {}
Expected: {'errCode': 0, 'httpCode': 200}
----------------------------------------
ref_link = 2lbJr
{
  "/interfaces/loopback/add": {
    "PRESET": {
      "steps": {
        "1": {
          "endpoint": "/vrf",
          "method": "POST",
          "parameters": {
            "action": "add",
            "vrf_name": "2lbJr"
          },
          "expected": {
            "errCode": 0,
            "httpCode": 200
          }
        },
        "2": {
          "endpoint": "/interfaces/loopback/add",
          "method": "POST",
          "parameters": {
            "ifname": "lo0",
            "vrf_name": "2lbJr"
          },
          "expected": {
            "errCode": 0,
            "httpCode": 200
          }
        }
      }
    },
    "TESTS": {
      "1": {
        "description": "Add loopback with VRF",
        "steps": {
          "1": {
            "endpoint": "/interfaces/loopback/add",
            "method": "POST",
            "parameters": {
              "ifname": "lo0",
              "vrf_name": "2lbJr"
            },
            "expected": {
              "errCode": 0,
              "httpCode": 200
            }
          }
        }
      }
    },
    "AFTER-TEST": {
      "steps": {
        "1": {
          "endpoint": "/vrf",
          "method": "POST",
          "parameters": {
            "action": "delete",
            "vrf_name": "2lbJr"
          },
          "expected": {
            "errCode": 0,
            "httpCode": 200
          }
        }
      }
    }
  }
}
